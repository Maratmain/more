# Система мониторинга поведения AI-HR

## Обзор

Система мониторинга поведения автоматически анализирует речь и поведение кандидатов во время интервью, выявляя потенциальные проблемы и принимая соответствующие меры.

## Типы событий

### 1. Токсичность (toxicity)
- **Порог предупреждения**: 0.75
- **Критический порог**: 0.90 (почти без ложных срабатываний)
- **Модель**: `unbiased-toxic-roberta` (Perspective API совместимая)
- **Детекция**: оскорбления, угрозы, атаки на личность, ненормативная лексика

### 2. Нервное замирание (nervous_freeze)
- **Пауза**: ≥2.0 секунды между словами
- **Темп речи**: <80 слов/минуту
- **Индикаторы**: длинные паузы + падение темпа = "ступор"
- **Поддержка**: предложение паузы, ободрение

### 3. Раздражительность (irritability)
- **Порог гнева**: ≥0.7 в эмоциональном анализе
- **Просодика**: высокая вариативность тона, энергия речи
- **Реакция**: де-эскалация, спокойное обсуждение

### 4. Низкая достоверность (low_truthfulness)
- **Противоречия**: несоответствия с CV/JD
- **Уклончивость**: уклончивые ответы после L3/L4 вопросов
- **Подход**: не обвинение, а запрос конкретики

## Пороговые значения

```yaml
toxicity:
  threshold_hi: 0.90      # Критический уровень
  threshold_warn: 0.75    # Предупреждение

nervous_freeze:
  pause_ms: 2000          # 2 секунды паузы
  words_per_min_low: 80   # 80 слов/мин

low_truthfulness:
  contradiction_score: 0.8    # Порог противоречий
  evasive_threshold: 3        # 3 уклончивых ответа

irritability:
  ser_anger_score: 0.7       # Порог гнева
```

## Действия по уровням

### Низкий уровень
- **Действие**: `continue`
- **Фраза**: "Понимаю, продолжайте..."

### Средний уровень
- **Действие**: `micro_backchannel` или `pause_offer`
- **Фразы**: "Хорошо, расскажите подробнее..." / "Предлагаю паузу на 2 минуты"

### Высокий уровень
- **Действие**: `warning`
- **Фраза**: "Давайте соблюдаем деловой тон. Если продолжится, завершим разговор."

### Критический уровень
- **Действие**: `end`
- **Фраза**: "Вынужден завершить интервью. Мы свяжемся позже."

## Научное обоснование

### Токсичность
- **Perspective API**: порог 0.90 обеспечивает минимум ложных срабатываний
- **Исследования**: автоматическая модерация эффективна при правильных порогах

### Нервное замирание
- **Колумбийский университет**: пауза >2 сек + падение темпа = индикатор стресса
- **Практика**: поддержка снижает тревожность кандидатов

### Достоверность
- **Мета-анализы**: невербальные "признаки лжи" ненадежны
- **Вербальные индикаторы**: противоречия и уклончивость более диагностичны
- **Подход**: флагирование для верификации, не автоматические отказы

## Интеграция

### ASR → Behavior Events
```python
# Эмит событий из ASR
behavior_event = BehaviorEvent(
    type="nervous_freeze",
    score=0.7,
    timestamp=time.time(),
    session_id=session_id,
    evidence={
        "max_pause_ms": 3500,
        "wpm": 45,
        "filler_count": 8
    }
)
```

### DM → Policy Response
```python
# LLM сценарист реакций
policy = await dm_service.get_behavior_policy(
    role_profile=profile,
    behavior_events=events,
    last_user_text=text,
    current_node=node
)
```

### Realtime Client → Actions
```javascript
// Выполнение действий в реальном времени
if (policy.action === "warning") {
    tts.speak(policy.phrase);
    showWarning(policy.phrase);
} else if (policy.action === "end") {
    endInterview();
}
```

## Конфигурация

### Переменные окружения
```bash
# Пороги поведения
BEHAVIOR_TOXICITY_WARN=0.75
BEHAVIOR_TOXICITY_HI=0.90
BEHAVIOR_PAUSE_MS=2000
BEHAVIOR_WPM_LOW=80
BEHAVIOR_SER_ANGER=0.7
```

### Настройка policy.yaml
```yaml
# Изменение порогов
toxicity:
  threshold_hi: 0.95    # Более строгий порог
  threshold_warn: 0.80  # Более высокое предупреждение
```

## Мониторинг и логирование

### Инциденты
- Автоматическое логирование критических событий
- Уведомления админов в Telegram
- Детальные доказательства и контекст

### Метрики
- Частота событий по типам
- Эффективность действий
- Время реакции системы

## Безопасность и этика

### Приватность
- Анализ только речевых паттернов
- Локальная обработка видео (опционально)
- Согласие на анализ

### Справедливость
- Избегание дискриминации
- Прозрачность алгоритмов
- Возможность обжалования

### Соответствие
- GDPR совместимость
- Аудит логирования
- Контроль доступа к данным
